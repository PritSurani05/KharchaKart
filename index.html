<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KharchaKart v8 - Smart Expense Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        /* Enhanced Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-up {
            animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .bounce-in {
            animation: bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3) rotate(-10deg); }
            50% { opacity: 1; transform: scale(1.1) rotate(5deg); }
            70% { transform: scale(0.9) rotate(-2deg); }
            100% { opacity: 1; transform: scale(1) rotate(0deg); }
        }
        
        .float {
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-15px) rotate(1deg); }
            66% { transform: translateY(-5px) rotate(-1deg); }
        }
        
        .pulse-glow {
            animation: pulseGlow 2s ease-in-out infinite;
        }
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
            50% { box-shadow: 0 0 40px rgba(59, 130, 246, 0.6); }
        }
        
        .shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .glass {
            backdrop-filter: blur(16px);
            background: rgba(255, 255, 255, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .glass-dark {
            backdrop-filter: blur(16px);
            background: rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .card-hover {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        
        .expense-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .expense-item:hover {
            transform: translateX(8px);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(147, 51, 234, 0.05) 100%);
        }
        
        .status-indicator {
            position: relative;
            overflow: hidden;
        }
        .status-indicator::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }
        .status-indicator:hover::before {
            left: 100%;
        }
        
        /* Enhanced Mobile Responsiveness */
        @media (max-width: 768px) {
            .mobile-stack {
                flex-direction: column;
            }
            .mobile-full {
                width: 100%;
            }
        }
        
        /* Dark Mode Support */
        .dark-mode {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: #f1f5f9;
        }
        
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.7);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen">
    <div id="app"></div>

    <script>
        // Enhanced App State Management
        const AppState = {
            currentUser: null,
            currentView: 'landing',
            expenses: [],
            approvals: [],
            notifications: [],
            settings: {
                theme: 'light',
                currency: 'INR',
                notifications: true,
                autoApproval: false
            },
            categories: [
                { name: 'Travel', icon: '‚úàÔ∏è', color: 'blue' },
                { name: 'Meals', icon: 'üçΩÔ∏è', color: 'green' },
                { name: 'Office Supplies', icon: 'üìé', color: 'yellow' },
                { name: 'Software', icon: 'üíª', color: 'purple' },
                { name: 'Marketing', icon: 'üì¢', color: 'pink' },
                { name: 'Training', icon: 'üìö', color: 'indigo' },
                { name: 'Equipment', icon: 'üîß', color: 'gray' },
                { name: 'Healthcare', icon: 'üè•', color: 'red' },
                { name: 'Transportation', icon: 'üöó', color: 'cyan' },
                { name: 'Other', icon: 'üìã', color: 'slate' }
            ],
            exchangeRates: { 
                USD: 83.12, EUR: 89.45, GBP: 104.23, INR: 1, 
                CAD: 61.45, AUD: 54.32, SGD: 61.89, JPY: 0.56 
            },
            expenseFilters: { 
                status: 'all', 
                category: 'all', 
                dateRange: 'all',
                amountRange: 'all'
            },
            
            // Enhanced User Database
            users: {
                'admin@kharcha.com': { 
                    id: '1', 
                    name: 'Alex Admin', 
                    role: 'admin', 
                    email: 'admin@kharcha.com', 
                    password: 'admin123',
                    department: 'Administration',
                    joinDate: '2023-01-15',
                    avatar: 'üë®‚Äçüíº',
                    permissions: ['approve_all', 'view_analytics', 'manage_users'],
                    approvalLimit: 100000
                },
                'manager@kharcha.com': { 
                    id: '2', 
                    name: 'Sarah Manager', 
                    role: 'manager', 
                    email: 'manager@kharcha.com', 
                    password: 'manager123',
                    department: 'Operations',
                    joinDate: '2023-03-20',
                    avatar: 'üë©‚Äçüíº',
                    permissions: ['approve_team', 'view_team_analytics'],
                    approvalLimit: 50000
                },
                'employee@kharcha.com': { 
                    id: '3', 
                    name: 'John Employee', 
                    role: 'employee', 
                    email: 'employee@kharcha.com', 
                    password: 'employee123',
                    department: 'Sales',
                    joinDate: '2023-06-10',
                    avatar: 'üë®‚Äçüíª',
                    permissions: ['submit_expenses', 'view_own_expenses'],
                    approvalLimit: 0
                },
                'finance@kharcha.com': { 
                    id: '4', 
                    name: 'Lisa Finance', 
                    role: 'finance', 
                    email: 'finance@kharcha.com', 
                    password: 'finance123',
                    department: 'Finance',
                    joinDate: '2023-02-01',
                    avatar: 'üë©‚Äçüí∞',
                    permissions: ['approve_all', 'view_analytics', 'export_data'],
                    approvalLimit: 75000
                }
            },
            
            // Enhanced Sample Expenses
            sampleExpenses: [
                {
                    id: '1',
                    amount: 2500,
                    currency: 'INR',
                    category: 'Travel',
                    description: 'Flight tickets to Mumbai for client meeting',
                    date: '2024-01-15',
                    status: 'pending',
                    submittedBy: 'John Employee',
                    submittedById: '3',
                    approvalFlow: ['manager', 'admin'],
                    currentApprover: 'manager',
                    receipt: 'flight-receipt.pdf',
                    submittedAt: '2024-01-16T10:30:00Z',
                    notes: 'Urgent client meeting in Mumbai office',
                    tags: ['urgent', 'client-meeting'],
                    location: 'Mumbai, India',
                    vendor: 'IndiGo Airlines'
                },
                {
                    id: '2',
                    amount: 150,
                    currency: 'USD',
                    category: 'Meals',
                    description: 'Client dinner at The Oberoi',
                    date: '2024-01-14',
                    status: 'approved',
                    submittedBy: 'John Employee',
                    submittedById: '3',
                    approvalFlow: ['manager'],
                    currentApprover: null,
                    receipt: 'dinner-receipt.jpg',
                    submittedAt: '2024-01-15T09:15:00Z',
                    approvedAt: '2024-01-15T14:20:00Z',
                    approvedBy: 'Sarah Manager',
                    tags: ['client-entertainment'],
                    location: 'New Delhi, India',
                    vendor: 'The Oberoi Hotel'
                },
                {
                    id: '3',
                    amount: 899,
                    currency: 'USD',
                    category: 'Software',
                    description: 'Adobe Creative Suite Annual License',
                    date: '2024-01-10',
                    status: 'approved',
                    submittedBy: 'John Employee',
                    submittedById: '3',
                    approvalFlow: ['manager', 'admin'],
                    currentApprover: null,
                    receipt: 'adobe-invoice.pdf',
                    submittedAt: '2024-01-10T11:00:00Z',
                    approvedAt: '2024-01-12T16:45:00Z',
                    approvedBy: 'Alex Admin',
                    tags: ['software', 'annual-license'],
                    location: 'Online Purchase',
                    vendor: 'Adobe Inc.'
                },
                {
                    id: '4',
                    amount: 45,
                    currency: 'EUR',
                    category: 'Office Supplies',
                    description: 'Wireless mouse and keyboard',
                    date: '2024-01-12',
                    status: 'rejected',
                    submittedBy: 'John Employee',
                    submittedById: '3',
                    approvalFlow: ['manager'],
                    currentApprover: null,
                    receipt: 'office-supplies.jpg',
                    submittedAt: '2024-01-13T08:30:00Z',
                    rejectedAt: '2024-01-13T15:10:00Z',
                    rejectedBy: 'Sarah Manager',
                    rejectionReason: 'Please use company-approved suppliers for office supplies',
                    tags: ['office-equipment'],
                    location: 'Amazon EU',
                    vendor: 'Logitech'
                },
                {
                    id: '5',
                    amount: 1200,
                    currency: 'INR',
                    category: 'Training',
                    description: 'React.js Advanced Workshop',
                    date: '2024-01-08',
                    status: 'pending',
                    submittedBy: 'John Employee',
                    submittedById: '3',
                    approvalFlow: ['manager', 'admin'],
                    currentApprover: 'admin',
                    receipt: 'training-invoice.pdf',
                    submittedAt: '2024-01-09T14:20:00Z',
                    notes: 'Will help improve development skills for upcoming projects',
                    tags: ['professional-development', 'react'],
                    location: 'Bangalore, India',
                    vendor: 'TechEd Institute'
                },
                {
                    id: '6',
                    amount: 75,
                    currency: 'USD',
                    category: 'Transportation',
                    description: 'Uber rides for client meetings',
                    date: '2024-01-20',
                    status: 'approved',
                    submittedBy: 'John Employee',
                    submittedById: '3',
                    approvalFlow: ['manager'],
                    currentApprover: null,
                    receipt: 'uber-receipts.pdf',
                    submittedAt: '2024-01-21T08:00:00Z',
                    approvedAt: '2024-01-21T12:30:00Z',
                    approvedBy: 'Sarah Manager',
                    tags: ['transportation', 'client-meetings'],
                    location: 'Mumbai, India',
                    vendor: 'Uber Technologies'
                }
            ]
        };

        // Initialize enhanced sample data
        AppState.expenses = [...AppState.sampleExpenses];
        AppState.notifications = [
            {
                id: 'notif1',
                title: '‚úÖ Expense Approved',
                message: 'Your transportation expense of $75 has been approved by Sarah Manager',
                type: 'success',
                timestamp: new Date(Date.now() - 5 * 60 * 1000).toISOString(),
                read: false,
                actionUrl: '/expenses/6'
            },
            {
                id: 'notif2',
                title: 'üìÑ New Expense Submitted',
                message: 'John Employee submitted a travel expense for ‚Çπ2,500',
                type: 'info',
                timestamp: new Date(Date.now() - 15 * 60 * 1000).toISOString(),
                read: false,
                actionUrl: '/approvals'
            },
            {
                id: 'notif3',
                title: '‚ùå Expense Rejected',
                message: 'Office supplies expense rejected - Please use approved suppliers',
                type: 'error',
                timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                read: true,
                actionUrl: '/expenses/4'
            },
            {
                id: 'notif4',
                title: '‚ö†Ô∏è Approval Required',
                message: 'Training expense of ‚Çπ1,200 needs your approval',
                type: 'warning',
                timestamp: new Date(Date.now() - 4 * 60 * 60 * 1000).toISOString(),
                read: false,
                actionUrl: '/approvals'
            },
            {
                id: 'notif5',
                title: 'üéâ Monthly Report Ready',
                message: 'Your January expense report is ready for download',
                type: 'info',
                timestamp: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
                read: false,
                actionUrl: '/analytics'
            }
        ];

        // Enhanced Utility Functions
        const formatCurrency = (amount, currency = 'INR') => {
            return new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: currency,
                minimumFractionDigits: 0,
                maximumFractionDigits: 2
            }).format(amount);
        };

        const convertCurrency = (amount, fromCurrency, toCurrency = 'INR') => {
            if (fromCurrency === toCurrency) return amount;
            const rate = AppState.exchangeRates[fromCurrency] || 1;
            return amount * rate;
        };

        const generateId = () => Math.random().toString(36).substr(2, 9);

        const formatTimeAgo = (timestamp) => {
            const now = new Date();
            const time = new Date(timestamp);
            const diffInSeconds = Math.floor((now - time) / 1000);
            
            if (diffInSeconds < 60) return 'Just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
            if (diffInSeconds < 604800) return `${Math.floor(diffInSeconds / 86400)}d ago`;
            return time.toLocaleDateString();
        };

        const getCategoryIcon = (categoryName) => {
            const category = AppState.categories.find(c => c.name === categoryName);
            return category ? category.icon : 'üìã';
        };

        const getCategoryColor = (categoryName) => {
            const category = AppState.categories.find(c => c.name === categoryName);
            return category ? category.color : 'gray';
        };

        // Enhanced Landing Page
        const LandingPage = () => `
            <div class="min-h-screen flex items-center justify-center p-4 relative overflow-hidden">
                <!-- Animated Background Elements -->
                <div class="absolute inset-0 overflow-hidden">
                    <div class="absolute -top-40 -right-40 w-80 h-80 bg-gradient-to-br from-blue-400 to-purple-600 rounded-full opacity-20 float" style="animation-delay: 0s;"></div>
                    <div class="absolute -bottom-40 -left-40 w-96 h-96 bg-gradient-to-tr from-green-400 to-blue-500 rounded-full opacity-20 float" style="animation-delay: 2s;"></div>
                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-gradient-to-r from-yellow-400 to-pink-500 rounded-full opacity-10 float" style="animation-delay: 4s;"></div>
                </div>
                
                <div class="max-w-6xl mx-auto text-center slide-up relative z-10">
                    <div class="mb-12">
                        <div class="bounce-in">
                            <div class="flex items-center justify-center mb-6">
                                <svg width="50" height="50" viewBox="0 0 80 80" class="mr-4 drop-shadow-lg">
            <!-- Cart Body -->
            <rect x="15" y="25" width="45" height="30" rx="4" fill="#8B5CF6" stroke="#581C87" stroke-width="2"/>
            
            <!-- Cart Handle -->
            <path d="M10 20 L15 20 L18 45 L55 45" stroke="#581C87" stroke-width="3" fill="none" stroke-linecap="round"/>
            
            <!-- Wheels -->
            <circle cx="25" cy="60" r="6" fill="#7C3AED" stroke="#581C87" stroke-width="2"/>
            <circle cx="50" cy="60" r="6" fill="#7C3AED" stroke="#581C87" stroke-width="2"/>
            
            <!-- Money Symbol in Cart -->
            <circle cx="37.5" cy="40" r="12" fill="#6D28D9" class="coin-spin"/>
            <text x="37.5" y="46" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#581C87">‚Çπ</text>
            
            <!-- Expense Lines -->
            <line x1="20" y1="30" x2="30" y2="30" stroke="#581C87" stroke-width="2" opacity="0.7"/>
            <line x1="45" y1="35" x2="55" y2="35" stroke="#581C87" stroke-width="2" opacity="0.7"/>
            <line x1="20" y1="50" x2="28" y2="50" stroke="#581C87" stroke-width="2" opacity="0.7"/>
        </svg>
        
        <!-- Company Name -->
        <div>
            <h1 class="text-4xl font-bold gradient-text">KarchaKart</h1>
            <p class="text-sm text-slate-500 font-medium">Expense Management</p>
        </div>
    </div>
                        </div>
                        <p class="text-2xl text-gray-600 mb-4 font-medium">Smart Expense Management ‚Ä¢ Reimagined</p>
                        <p class="text-lg text-gray-500 mb-12 max-w-2xl mx-auto">Experience the future of expense tracking with AI-powered OCR, real-time approvals, and intelligent analytics</p>
                        
                        <!-- Enhanced Feature Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-16">
                            <div class="glass rounded-2xl p-6 card-hover pulse-glow" style="animation-delay: 0.2s;">
                                <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                                    <i data-lucide="scan-line" class="w-8 h-8 text-white"></i>
                                </div>
                                <h3 class="text-lg font-bold text-gray-800 mb-2">AI OCR Scanning</h3>
                                <p class="text-sm text-gray-600">Instantly extract data from receipts with 99% accuracy</p>
                            </div>
                            
                            <div class="glass rounded-2xl p-6 card-hover" style="animation-delay: 0.4s;">
                                <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                                    <i data-lucide="users-2" class="w-8 h-8 text-white"></i>
                                </div>
                                <h3 class="text-lg font-bold text-gray-800 mb-2">Smart Approvals</h3>
                                <p class="text-sm text-gray-600">Multi-level approval workflows with real-time notifications</p>
                            </div>
                            
                            <div class="glass rounded-2xl p-6 card-hover" style="animation-delay: 0.6s;">
                                <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                                    <i data-lucide="globe-2" class="w-8 h-8 text-white"></i>
                                </div>
                                <h3 class="text-lg font-bold text-gray-800 mb-2">Global Currency</h3>
                                <p class="text-sm text-gray-600">Real-time currency conversion for international expenses</p>
                            </div>
                            
                            <div class="glass rounded-2xl p-6 card-hover" style="animation-delay: 0.8s;">
                                <div class="w-16 h-16 bg-gradient-to-br from-yellow-500 to-orange-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                                    <i data-lucide="bar-chart-3" class="w-8 h-8 text-white"></i>
                                </div>
                                <h3 class="text-lg font-bold text-gray-800 mb-2">Advanced Analytics</h3>
                                <p class="text-sm text-gray-600">Detailed insights and spending pattern analysis</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Enhanced Login Card -->
                    <div class="glass rounded-3xl shadow-2xl p-10 max-w-lg mx-auto bounce-in" style="animation-delay: 1s;">
                        <div class="mb-8">
                            <h2 class="text-3xl font-bold text-gray-800 mb-2">Get Started</h2>
                            <p class="text-gray-600">Join thousands of companies managing expenses smarter</p>
                        </div>
                        
                        <div class="space-y-4 mb-8">
                            <button onclick="navigateTo('login')" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white py-4 px-6 rounded-xl font-semibold transition-all transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center justify-center group">
                                <i data-lucide="log-in" class="w-5 h-5 mr-2 group-hover:scale-110 transition-transform"></i>
                                Sign In to Your Account
                            </button>
                            <button onclick="navigateTo('signup')" class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white py-4 px-6 rounded-xl font-semibold transition-all transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center justify-center group">
                                <i data-lucide="user-plus" class="w-5 h-5 mr-2 group-hover:scale-110 transition-transform"></i>
                                Create New Account
                            </button>
                        </div>
                        
                        <div class="border-t border-gray-200 pt-6">
                            <p class="text-sm text-gray-600 mb-4 font-medium">üöÄ Try Demo Accounts:</p>
                            <div class="grid grid-cols-1 gap-3">
                                <button onclick="quickLogin('admin@kharcha.com')" class="w-full bg-gradient-to-r from-red-50 to-red-100 hover:from-red-100 hover:to-red-200 text-red-700 py-3 px-4 rounded-lg font-medium transition-all transform hover:scale-105 flex items-center justify-center group border border-red-200">
                                    <span class="text-lg mr-2">üë®‚Äçüíº</span>
                                    <span class="group-hover:font-semibold transition-all">Admin Dashboard</span>
                                    <i data-lucide="arrow-right" class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform"></i>
                                </button>
                                <div class="grid grid-cols-2 gap-3">
                                    <button onclick="quickLogin('manager@kharcha.com')" class="bg-gradient-to-r from-blue-50 to-blue-100 hover:from-blue-100 hover:to-blue-200 text-blue-700 py-3 px-3 rounded-lg font-medium transition-all transform hover:scale-105 flex items-center justify-center group border border-blue-200">
                                        <span class="text-sm mr-1">üë©‚Äçüíº</span>
                                        <span class="text-sm group-hover:font-semibold transition-all">Manager</span>
                                    </button>
                                    <button onclick="quickLogin('employee@kharcha.com')" class="bg-gradient-to-r from-green-50 to-green-100 hover:from-green-100 hover:to-green-200 text-green-700 py-3 px-3 rounded-lg font-medium transition-all transform hover:scale-105 flex items-center justify-center group border border-green-200">
                                        <span class="text-sm mr-1">üë®‚Äçüíª</span>
                                        <span class="text-sm group-hover:font-semibold transition-all">Employee</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Trust Indicators -->
                    <div class="mt-16 fade-in" style="animation-delay: 1.5s;">
                        <p class="text-sm text-gray-500 mb-6">Trusted by 10,000+ companies worldwide</p>
                        <div class="flex items-center justify-center space-x-8 opacity-60">
                            <div class="text-2xl font-bold text-gray-400">TechCorp</div>
                            <div class="text-2xl font-bold text-gray-400">InnovateLab</div>
                            <div class="text-2xl font-bold text-gray-400">GlobalTech</div>
                            <div class="text-2xl font-bold text-gray-400">StartupXYZ</div>
                        </div>
                    </div>
                </div>
            </div>
        `;

        // Enhanced Dashboard with v8 features
        const Dashboard = () => {
            const user = AppState.currentUser;
            const userExpenses = user.role === 'employee' 
                ? AppState.expenses.filter(e => e.submittedById === user.id)
                : AppState.expenses;
            const pendingApprovals = AppState.expenses.filter(e => 
                e.status === 'pending' && 
                (user.role === 'admin' || user.role === 'finance' || 
                 (user.role === 'manager' && e.currentApprover === 'manager'))
            );

            // Enhanced Analytics
            const totalAmount = userExpenses.reduce((sum, e) => sum + convertCurrency(e.amount, e.currency), 0);
            const thisMonthExpenses = userExpenses.filter(e => {
                const expenseDate = new Date(e.date);
                const now = new Date();
                return expenseDate.getMonth() === now.getMonth() && expenseDate.getFullYear() === now.getFullYear();
            });
            const thisMonthAmount = thisMonthExpenses.reduce((sum, e) => sum + convertCurrency(e.amount, e.currency), 0);
            const avgExpenseAmount = userExpenses.length > 0 ? totalAmount / userExpenses.length : 0;
            const approvalRate = userExpenses.length > 0 ? 
                (userExpenses.filter(e => e.status === 'approved').length / userExpenses.length) * 100 : 0;

            return `
                <div class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
                    ${Header()}
                    <div class="max-w-7xl mx-auto px-4 py-8">
                        <!-- Enhanced Welcome Section -->
                        <div class="mb-8 fade-in">
                            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                                <div class="mb-4 lg:mb-0">
                                    <h1 class="text-4xl font-bold text-gray-800 mb-2">
                                        Welcome back, ${user.name}! 
                                        <span class="text-3xl">${user.avatar}</span>
                                    </h1>
                                    <div class="flex items-center space-x-4 text-gray-600">
                                        <span class="flex items-center">
                                            <i data-lucide="building" class="w-4 h-4 mr-1"></i>
                                            ${user.department}
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="shield" class="w-4 h-4 mr-1"></i>
                                            ${user.role.charAt(0).toUpperCase() + user.role.slice(1)}
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="calendar" class="w-4 h-4 mr-1"></i>
                                            Since ${new Date(user.joinDate).toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}
                                        </span>
                                    </div>
                                </div>
                                <div class="glass rounded-2xl p-6 text-center">
                                    <p class="text-sm text-gray-600 mb-1">Total Expenses</p>
                                    <p class="text-3xl font-bold gradient-text">${formatCurrency(totalAmount)}</p>
                                    <p class="text-xs text-gray-500">${userExpenses.length} transactions</p>
                                </div>
                            </div>
                        </div>

                        <!-- Enhanced Stats Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="glass rounded-2xl shadow-lg p-6 card-hover fade-in" style="animation-delay: 0.1s;">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center">
                                        <i data-lucide="receipt" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-2xl font-bold text-gray-800">${userExpenses.length}</p>
                                        <p class="text-xs text-blue-600 font-medium">Total Expenses</p>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-600">This month: ${thisMonthExpenses.length}</span>
                                    <span class="text-green-600 font-medium">+${Math.round(Math.random() * 20)}%</span>
                                </div>
                                <div class="mt-3 bg-gray-200 rounded-full h-2">
                                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full" style="width: ${Math.min((thisMonthExpenses.length / Math.max(userExpenses.length, 1)) * 100, 100)}%"></div>
                                </div>
                            </div>
                            
                            <div class="glass rounded-2xl shadow-lg p-6 card-hover fade-in" style="animation-delay: 0.2s;">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center">
                                        <i data-lucide="check-circle" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-2xl font-bold text-gray-800">${userExpenses.filter(e => e.status === 'approved').length}</p>
                                        <p class="text-xs text-green-600 font-medium">Approved</p>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-600">Approval rate</span>
                                    <span class="text-green-600 font-medium">${Math.round(approvalRate)}%</span>
                                </div>
                                <div class="mt-3 bg-gray-200 rounded-full h-2">
                                    <div class="bg-gradient-to-r from-green-500 to-green-600 h-2 rounded-full" style="width: ${approvalRate}%"></div>
                                </div>
                            </div>
                            
                            <div class="glass rounded-2xl shadow-lg p-6 card-hover fade-in" style="animation-delay: 0.3s;">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-br from-yellow-500 to-orange-500 rounded-xl flex items-center justify-center">
                                        <i data-lucide="trending-up" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-2xl font-bold text-gray-800">${formatCurrency(avgExpenseAmount).replace('‚Çπ', '‚Çπ')}</p>
                                        <p class="text-xs text-yellow-600 font-medium">Avg Amount</p>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-600">This month: ${formatCurrency(thisMonthAmount)}</span>
                                </div>
                                <div class="mt-3 bg-gray-200 rounded-full h-2">
                                    <div class="bg-gradient-to-r from-yellow-500 to-orange-500 h-2 rounded-full" style="width: ${Math.min((thisMonthAmount / Math.max(totalAmount, 1)) * 100, 100)}%"></div>
                                </div>
                            </div>
                            
                            <div class="glass rounded-2xl shadow-lg p-6 card-hover fade-in" style="animation-delay: 0.4s;">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center">
                                        <i data-lucide="${user.role !== 'employee' ? 'users' : 'clock'}" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-2xl font-bold text-gray-800">${user.role !== 'employee' ? pendingApprovals.length : userExpenses.filter(e => e.status === 'pending').length}</p>
                                        <p class="text-xs text-purple-600 font-medium">${user.role !== 'employee' ? 'Pending Approvals' : 'Pending'}</p>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-600">Needs attention</span>
                                    ${(user.role !== 'employee' ? pendingApprovals.length : userExpenses.filter(e => e.status === 'pending').length) > 0 ? 
                                        '<span class="text-red-600 font-medium animate-pulse">Urgent</span>' : 
                                        '<span class="text-green-600 font-medium">All clear</span>'
                                    }
                                </div>
                                <div class="mt-3 bg-gray-200 rounded-full h-2">
                                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 h-2 rounded-full animate-pulse" style="width: ${(user.role !== 'employee' ? pendingApprovals.length : userExpenses.filter(e => e.status === 'pending').length) > 0 ? '100' : '0'}%"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Enhanced Main Content Grid -->
                        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                            <!-- Quick Actions - Enhanced -->
                            <div class="lg:col-span-4">
                                <div class="glass rounded-2xl shadow-lg p-6 fade-in">
                                    <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                        <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-500 rounded-lg flex items-center justify-center mr-3">
                                            <i data-lucide="zap" class="w-4 h-4 text-white"></i>
                                        </div>
                                        Quick Actions
                                    </h2>
                                    <div class="space-y-4">
                                        <button onclick="navigateTo('submit')" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white py-4 px-6 rounded-xl font-semibold transition-all flex items-center justify-center group transform hover:scale-105 shadow-lg hover:shadow-xl">
                                            <i data-lucide="plus-circle" class="w-5 h-5 mr-3 group-hover:scale-110 transition-transform"></i>
                                            Submit New Expense
                                            <i data-lucide="arrow-right" class="w-4 h-4 ml-auto group-hover:translate-x-1 transition-transform"></i>
                                        </button>
                                        
                                        <button onclick="navigateTo('expenses')" class="w-full bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white py-4 px-6 rounded-xl font-semibold transition-all flex items-center justify-center group transform hover:scale-105 shadow-lg hover:shadow-xl">
                                            <i data-lucide="list" class="w-5 h-5 mr-3 group-hover:scale-110 transition-transform"></i>
                                            View All Expenses
                                            <i data-lucide="arrow-right" class="w-4 h-4 ml-auto group-hover:translate-x-1 transition-transform"></i>
                                        </button>
                                        
                                        ${user.role !== 'employee' ? `
                                        <button onclick="navigateTo('approvals')" class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white py-4 px-6 rounded-xl font-semibold transition-all flex items-center justify-center group transform hover:scale-105 shadow-lg hover:shadow-xl relative">
                                            <i data-lucide="check-square" class="w-5 h-5 mr-3 group-hover:scale-110 transition-transform"></i>
                                            Review Approvals
                                            ${pendingApprovals.length > 0 ? `<span class="ml-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full">${pendingApprovals.length}</span>` : ''}
                                            <i data-lucide="arrow-right" class="w-4 h-4 ml-auto group-hover:translate-x-1 transition-transform"></i>
                                        </button>
                                        ` : ''}
                                        
                                        <button onclick="navigateTo('analytics')" class="w-full bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white py-4 px-6 rounded-xl font-semibold transition-all flex items-center justify-center group transform hover:scale-105 shadow-lg hover:shadow-xl">
                                            <i data-lucide="bar-chart-3" class="w-5 h-5 mr-3 group-hover:scale-110 transition-transform"></i>
                                            View Analytics
                                            <i data-lucide="arrow-right" class="w-4 h-4 ml-auto group-hover:translate-x-1 transition-transform"></i>
                                        </button>
                                    </div>
                                    
                                    <!-- Quick Stats -->
                                    <div class="mt-6 pt-6 border-t border-gray-200">
                                        <h3 class="text-sm font-semibold text-gray-700 mb-3">Quick Stats</h3>
                                        <div class="grid grid-cols-2 gap-3">
                                            <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-3 rounded-lg">
                                                <p class="text-xs text-blue-600 font-medium">This Week</p>
                                                <p class="text-lg font-bold text-blue-800">${Math.floor(Math.random() * 5) + 1}</p>
                                            </div>
                                            <div class="bg-gradient-to-br from-green-50 to-green-100 p-3 rounded-lg">
                                                <p class="text-xs text-green-600 font-medium">Avg Time</p>
                                                <p class="text-lg font-bold text-green-800">${Math.floor(Math.random() * 24) + 1}h</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Enhanced Recent Activity -->
                            <div class="lg:col-span-8">
                                <div class="glass rounded-2xl shadow-lg p-6 fade-in">
                                    <div class="flex items-center justify-between mb-6">
                                        <h2 class="text-xl font-bold text-gray-800 flex items-center">
                                            <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-blue-500 rounded-lg flex items-center justify-center mr-3">
                                                <i data-lucide="activity" class="w-4 h-4 text-white"></i>
                                            </div>
                                            Recent Activity
                                        </h2>
                                        <div class="flex items-center space-x-3">
                                            <button onclick="window.refreshActivity()" class="text-gray-400 hover:text-gray-600 transition-colors transform hover:rotate-180 duration-300 p-2 rounded-lg hover:bg-gray-100" title="Refresh">
                                                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                            </button>
                                            <button onclick="navigateTo('expenses')" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all transform hover:scale-105 flex items-center">
                                                View All
                                                <i data-lucide="external-link" class="w-3 h-3 ml-1"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="space-y-4 max-h-96 overflow-y-auto custom-scrollbar">
                                        ${userExpenses.length > 0 ? userExpenses
                                            .sort((a, b) => new Date(b.submittedAt || b.date) - new Date(a.submittedAt || a.date))
                                            .slice(0, 8).map((expense, index) => `
                                            <div class="expense-item group relative flex items-center p-4 bg-gradient-to-r from-white to-gray-50 rounded-xl cursor-pointer border border-gray-100 hover:border-blue-200 hover:shadow-lg transition-all duration-300" onclick="window.viewExpenseDetail('${expense.id}')" style="animation-delay: ${index * 0.1}s">
                                                <!-- Enhanced Status Indicator -->
                                                <div class="absolute left-0 top-0 bottom-0 w-1 rounded-l-xl status-indicator ${
                                                    expense.status === 'approved' ? 'bg-gradient-to-b from-green-400 to-green-600' : 
                                                    expense.status === 'rejected' ? 'bg-gradient-to-b from-red-400 to-red-600' :
                                                    'bg-gradient-to-b from-yellow-400 to-yellow-600'
                                                }"></div>
                                                
                                                <div class="flex items-center space-x-4 flex-1">
                                                    <!-- Category Icon -->
                                                    <div class="relative">
                                                        <div class="w-14 h-14 rounded-xl bg-gradient-to-br ${
                                                            expense.status === 'approved' ? 'from-green-100 to-green-200' : 
                                                            expense.status === 'rejected' ? 'from-red-100 to-red-200' :
                                                            'from-yellow-100 to-yellow-200'
                                                        } flex items-center justify-center group-hover:scale-110 transition-transform duration-300 shadow-sm">
                                                            <span class="text-xl">${getCategoryIcon(expense.category)}</span>
                                                        </div>
                                                        ${expense.status === 'pending' ? `
                                                            <div class="absolute -top-1 -right-1 w-4 h-4 bg-orange-400 rounded-full animate-pulse flex items-center justify-center">
                                                                <div class="w-2 h-2 bg-white rounded-full"></div>
                                                            </div>
                                                        ` : ''}
                                                    </div>
                                                    
                                                    <!-- Expense Details -->
                                                    <div class="flex-1 min-w-0">
                                                        <div class="flex items-center space-x-3 mb-2">
                                                            <h3 class="font-semibold text-gray-800 text-sm group-hover:text-blue-700 transition-colors truncate">
                                                                ${expense.description.length > 35 ? expense.description.substring(0, 35) + '...' : expense.description}
                                                            </h3>
                                                            <span class="inline-flex px-3 py-1 text-xs font-semibold rounded-full ${
                                                                expense.status === 'approved' ? 'bg-green-100 text-green-700 group-hover:bg-green-200' : 
                                                                expense.status === 'rejected' ? 'bg-red-100 text-red-700 group-hover:bg-red-200' :
                                                                'bg-yellow-100 text-yellow-700 group-hover:bg-yellow-200'
                                                            } transition-all">
                                                                ${expense.status.toUpperCase()}
                                                            </span>
                                                        </div>
                                                        <div class="flex items-center space-x-4 text-xs text-gray-600 group-hover:text-blue-600 transition-colors">
                                                            <span class="flex items-center bg-gray-100 px-2 py-1 rounded-md">
                                                                <i data-lucide="tag" class="w-3 h-3 mr-1"></i>
                                                                ${expense.category}
                                                            </span>
                                                            <span class="flex items-center">
                                                                <i data-lucide="calendar" class="w-3 h-3 mr-1"></i>
                                                                ${new Date(expense.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                                                            </span>
                                                            <span class="flex items-center">
                                                                <i data-lucide="user" class="w-3 h-3 mr-1"></i>
                                                                ${expense.submittedBy.split(' ')[0]}
                                                            </span>
                                                            ${expense.location ? `
                                                                <span class="flex items-center">
                                                                    <i data-lucide="map-pin" class="w-3 h-3 mr-1"></i>
                                                                    ${expense.location.split(',')[0]}
                                                                </span>
                                                            ` : ''}
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Amount and Actions -->
                                                <div class="flex items-center space-x-4">
                                                    <div class="text-right">
                                                        <p class="font-bold text-gray-800 text-lg group-hover:text-blue-700 transition-colors">
                                                            ${formatCurrency(expense.amount, expense.currency)}
                                                        </p>
                                                        ${expense.currency !== 'INR' ? `
                                                            <p class="text-xs text-gray-500 group-hover:text-blue-500 transition-colors">
                                                                ${formatCurrency(convertCurrency(expense.amount, expense.currency))}
                                                            </p>
                                                        ` : ''}
                                                    </div>
                                                    
                                                    <!-- Action Buttons -->
                                                    <div class="flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                                        <button onclick="event.stopPropagation(); window.viewExpenseDetail('${expense.id}')" class="p-2 text-blue-500 hover:text-blue-700 hover:bg-blue-100 rounded-lg transition-all" title="View Details">
                                                            <i data-lucide="eye" class="w-4 h-4"></i>
                                                        </button>
                                                        ${expense.status === 'pending' && AppState.currentUser.id === expense.submittedById ? `
                                                            <button onclick="event.stopPropagation(); window.editExpense('${expense.id}')" class="p-2 text-green-500 hover:text-green-700 hover:bg-green-100 rounded-lg transition-all" title="Edit">
                                                                <i data-lucide="edit-2" class="w-4 h-4"></i>
                                                            </button>
                                                        ` : ''}
                                                    </div>
                                                    
                                                    <!-- Arrow Indicator -->
                                                    <div class="opacity-0 group-hover:opacity-100 transition-all transform group-hover:translate-x-1">
                                                        <i data-lucide="chevron-right" class="w-5 h-5 text-blue-500"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('') : `
                                            <div class="text-center py-16">
                                                <div class="w-24 h-24 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner">
                                                    <i data-lucide="receipt" class="w-12 h-12 text-gray-400"></i>
                                                </div>
                                                <h3 class="text-xl font-semibold text-gray-600 mb-3">No Activity Yet</h3>
                                                <p class="text-sm text-gray-500 mb-6 max-w-sm mx-auto">Start by submitting your first expense to see activity here. It's quick and easy!</p>
                                                <button onclick="navigateTo('submit')" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-8 py-4 rounded-xl font-semibold transition-all transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center mx-auto">
                                                    <i data-lucide="plus" class="w-5 h-5 mr-2"></i>
                                                    Submit First Expense
                                                </button>
                                            </div>
                                        `}
                                    </div>
                                    
                                    <!-- Enhanced Activity Summary -->
                                    ${userExpenses.length > 0 ? `
                                        <div class="mt-6 pt-6 border-t border-gray-200">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center space-x-6">
                                                    <div class="flex items-center space-x-2">
                                                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                                        <span class="text-sm text-gray-600">
                                                            <span class="font-semibold text-green-600">${userExpenses.filter(e => e.status === 'approved').length}</span> approved
                                                        </span>
                                                    </div>
                                                    <div class="flex items-center space-x-2">
                                                        <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                                        <span class="text-sm text-gray-600">
                                                            <span class="font-semibold text-yellow-600">${userExpenses.filter(e => e.status === 'pending').length}</span> pending
                                                        </span>
                                                    </div>
                                                    <div class="flex items-center space-x-2">
                                                        <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                                        <span class="text-sm text-gray-600">
                                                            <span class="font-semibold text-red-600">${userExpenses.filter(e => e.status === 'rejected').length}</span> rejected
                                                        </span>
                                                    </div>
                                                </div>
                                                <button onclick="navigateTo('expenses')" class="text-blue-500 hover:text-blue-700 font-medium transition-colors flex items-center text-sm">
                                                    View All ${userExpenses.length}
                                                    <i data-lucide="external-link" class="w-3 h-3 ml-1"></i>
                                                </button>
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        // Enhanced Header Component
        const Header = () => {
            const user = AppState.currentUser;
            const unreadNotifications = AppState.notifications.filter(n => !n.read).length;
            
            return `
                <header class="glass border-b backdrop-blur-md sticky top-0 z-40">
                    <div class="max-w-7xl mx-auto px-4">
                        <div class="flex items-center justify-between h-16">
                            <div class="flex items-center space-x-8">
                                <div class="flex items-center cursor-pointer group" onclick="navigateTo('dashboard')">
                                    <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center mr-3 shadow-md group-hover:scale-110 transition-transform">
                                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 2L2 7v10c0 5.55 3.84 9.74 9 11 5.16-1.26 9-5.45 9-11V7l-10-5z"/>
                                            <path d="M9 12l2 2 4-4" stroke="white" stroke-width="2" fill="none"/>
                                        </svg>
                                    </div>
                                    <h1 class="text-xl font-bold group-hover:scale-105 transition-transform">
                                        <span class="gradient-text">Kharcha</span><span class="text-indigo-600">Kart</span>
                                    </h1>
                                </div>
                                <nav class="hidden md:flex space-x-6">
                                    <button onclick="navigateTo('dashboard')" class="text-gray-600 hover:text-gray-900 font-medium transition-colors px-3 py-2 rounded-lg hover:bg-gray-100 ${AppState.currentView === 'dashboard' ? 'text-blue-600 bg-blue-50 border-b-2 border-blue-600' : ''}">
                                        <i data-lucide="home" class="w-4 h-4 mr-1 inline"></i>
                                        Dashboard
                                    </button>
                                    <button onclick="navigateTo('submit')" class="text-gray-600 hover:text-gray-900 font-medium transition-colors px-3 py-2 rounded-lg hover:bg-gray-100 ${AppState.currentView === 'submit' ? 'text-blue-600 bg-blue-50 border-b-2 border-blue-600' : ''}">
                                        <i data-lucide="plus-circle" class="w-4 h-4 mr-1 inline"></i>
                                        Submit
                                    </button>
                                    <button onclick="navigateTo('expenses')" class="text-gray-600 hover:text-gray-900 font-medium transition-colors px-3 py-2 rounded-lg hover:bg-gray-100 ${AppState.currentView === 'expenses' ? 'text-blue-600 bg-blue-50 border-b-2 border-blue-600' : ''}">
                                        <i data-lucide="receipt" class="w-4 h-4 mr-1 inline"></i>
                                        Expenses
                                    </button>
                                    ${user.role !== 'employee' ? `
                                    <button onclick="navigateTo('approvals')" class="text-gray-600 hover:text-gray-900 font-medium transition-colors px-3 py-2 rounded-lg hover:bg-gray-100 relative ${AppState.currentView === 'approvals' ? 'text-blue-600 bg-blue-50 border-b-2 border-blue-600' : ''}">
                                        <i data-lucide="check-square" class="w-4 h-4 mr-1 inline"></i>
                                        Approvals
                                        ${AppState.expenses.filter(e => e.status === 'pending' && (user.role === 'admin' || user.role === 'finance' || (user.role === 'manager' && e.currentApprover === 'manager'))).length > 0 ? `
                                            <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-pulse">${AppState.expenses.filter(e => e.status === 'pending' && (user.role === 'admin' || user.role === 'finance' || (user.role === 'manager' && e.currentApprover === 'manager'))).length}</span>
                                        ` : ''}
                                    </button>
                                    ` : ''}
                                    <button onclick="navigateTo('analytics')" class="text-gray-600 hover:text-gray-900 font-medium transition-colors px-3 py-2 rounded-lg hover:bg-gray-100 ${AppState.currentView === 'analytics' ? 'text-blue-600 bg-blue-50 border-b-2 border-blue-600' : ''}">
                                        <i data-lucide="bar-chart-3" class="w-4 h-4 mr-1 inline"></i>
                                        Analytics
                                    </button>
                                </nav>
                            </div>
                            
                            <div class="flex items-center space-x-4">
                                <!-- Enhanced Notifications -->
                                <div class="relative">
                                    <button onclick="window.toggleNotifications()" class="text-gray-600 hover:text-gray-900 relative transition-all transform hover:scale-110 p-2 rounded-lg hover:bg-gray-100">
                                        <i data-lucide="bell" class="w-5 h-5"></i>
                                        ${unreadNotifications > 0 ? `
                                            <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-pulse font-bold">
                                                ${unreadNotifications > 9 ? '9+' : unreadNotifications}
                                            </span>
                                        ` : ''}
                                    </button>
                                    
                                    <div id="notificationPanel" class="hidden absolute right-0 mt-2 w-96 glass rounded-2xl shadow-2xl border border-gray-200 z-50 max-h-96 overflow-hidden">
                                        <div class="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50">
                                            <div class="flex items-center justify-between">
                                                <h3 class="text-lg font-bold text-gray-800 flex items-center">
                                                    <i data-lucide="bell" class="w-5 h-5 mr-2 text-blue-600"></i>
                                                    Notifications
                                                </h3>
                                                ${AppState.notifications.length > 0 ? `
                                                <button onclick="window.clearAllNotifications()" class="text-sm text-blue-600 hover:text-blue-800 font-medium transition-colors px-3 py-1 rounded-lg hover:bg-blue-100">
                                                    Clear All
                                                </button>
                                                ` : ''}
                                            </div>
                                            ${unreadNotifications > 0 ? `
                                                <p class="text-xs text-blue-600 mt-1">${unreadNotifications} unread notification${unreadNotifications > 1 ? 's' : ''}</p>
                                            ` : ''}
                                        </div>
                                        <div class="max-h-80 overflow-y-auto custom-scrollbar">
                                            ${AppState.notifications.length > 0 ? AppState.notifications.map((notification, index) => `
                                                <div class="px-6 py-4 border-b border-gray-100 hover:bg-gradient-to-r hover:from-gray-50 hover:to-blue-50 transition-all cursor-pointer ${!notification.read ? 'bg-blue-25' : ''}" onclick="window.handleNotificationClick('${notification.id}')">
                                                    <div class="flex items-start space-x-4">
                                                        <div class="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ${
                                                            notification.type === 'success' ? 'bg-green-100' :
                                                            notification.type === 'error' ? 'bg-red-100' :
                                                            notification.type === 'warning' ? 'bg-yellow-100' :
                                                            'bg-blue-100'
                                                        }">
                                                            <i data-lucide="${
                                                                notification.type === 'success' ? 'check-circle' :
                                                                notification.type === 'error' ? 'x-circle' :
                                                                notification.type === 'warning' ? 'alert-triangle' :
                                                                'info'
                                                            }" class="w-5 h-5 ${
                                                                notification.type === 'success' ? 'text-green-600' :
                                                                notification.type === 'error' ? 'text-red-600' :
                                                                notification.type === 'warning' ? 'text-yellow-600' :
                                                                'text-blue-600'
                                                            }"></i>
                                                        </div>
                                                        <div class="flex-1 min-w-0">
                                                            <div class="flex items-center justify-between">
                                                                <p class="text-sm font-semibold text-gray-800">${notification.title}</p>
                                                                ${!notification.read ? `
                                                                    <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                                                                ` : ''}
                                                            </div>
                                                            <p class="text-sm text-gray-600 mt-1">${notification.message}</p>
                                                            <div class="flex items-center justify-between mt-2">
                                                                <p class="text-xs text-gray-400">${formatTimeAgo(notification.timestamp)}</p>
                                                                <button onclick="event.stopPropagation(); window.dismissNotification('${notification.id}')" class="text-gray-400 hover:text-gray-600 transition-colors p-1 rounded hover:bg-gray-200">
                                                                    <i data-lucide="x" class="w-3 h-3"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            `).join('') : `
                                                <div class="px-6 py-12 text-center">
                                                    <i data-lucide="bell-off" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                                                    <p class="text-sm text-gray-500 font-medium">No notifications yet</p>
                                                    <p class="text-xs text-gray-400 mt-1">You'll see updates here when they arrive</p>
                                                </div>
                                            `}
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Enhanced Profile Dropdown -->
                                <div class="relative">
                                    <button onclick="window.toggleProfileMenu()" class="flex items-center space-x-3 text-gray-600 hover:text-gray-900 focus:outline-none transition-all transform hover:scale-105 p-2 rounded-lg hover:bg-gray-100">
                                        <div class="w-10 h-10 bg-gradient-to-br from-blue-100 to-indigo-200 rounded-full flex items-center justify-center text-lg shadow-md">
                                            ${user.avatar}
                                        </div>
                                        <div class="text-left hidden sm:block">
                                            <p class="text-sm font-semibold text-gray-800">${user.name}</p>
                                            <p class="text-xs text-gray-600 capitalize">${user.role} ‚Ä¢ ${user.department}</p>
                                        </div>
                                        <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                    </button>
                                    
                                    <div id="profileMenu" class="hidden absolute right-0 mt-2 w-64 glass rounded-xl shadow-2xl border border-gray-200 z-50">
                                        <div class="p-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-blue-50">
                                            <div class="flex items-center space-x-3">
                                                <div class="w-12 h-12 bg-gradient-to-br from-blue-100 to-indigo-200 rounded-full flex items-center justify-center text-xl">
                                                    ${user.avatar}
                                                </div>
                                                <div>
                                                    <p class="font-semibold text-gray-800">${user.name}</p>
                                                    <p class="text-xs text-gray-600">${user.email}</p>
                                                    <p class="text-xs text-blue-600 capitalize">${user.role} ‚Ä¢ ${user.department}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="py-2">
                                            <button onclick="navigateTo('profile')" class="w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gradient-to-r hover:from-gray-50 hover:to-blue-50 flex items-center transition-colors group">
                                                <i data-lucide="user" class="w-4 h-4 mr-3 group-hover:scale-110 transition-transform"></i>
                                                Profile Settings
                                            </button>
                                            <button onclick="navigateTo('analytics')" class="w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gradient-to-r hover:from-gray-50 hover:to-blue-50 flex items-center transition-colors group">
                                                <i data-lucide="bar-chart-3" class="w-4 h-4 mr-3 group-hover:scale-110 transition-transform"></i>
                                                Analytics Dashboard
                                            </button>
                                            <button onclick="navigateTo('settings')" class="w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gradient-to-r hover:from-gray-50 hover:to-blue-50 flex items-center transition-colors group">
                                                <i data-lucide="settings" class="w-4 h-4 mr-3 group-hover:scale-110 transition-transform"></i>
                                                Settings
                                            </button>
                                            <div class="border-t border-gray-100 my-1"></div>
                                            <button onclick="window.logout()" class="w-full text-left px-4 py-3 text-sm text-red-600 hover:bg-red-50 flex items-center transition-colors group">
                                                <i data-lucide="log-out" class="w-4 h-4 mr-3 group-hover:scale-110 transition-transform"></i>
                                                Sign Out
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>
            `;
        };

        // Global Functions for Window Access
        window.navigateTo = (view) => {
            AppState.currentView = view;
            render();
        };

        window.quickLogin = (email) => {
            AppState.currentUser = AppState.users[email];
            AppState.currentView = 'dashboard';
            render();
        };

        window.logout = () => {
            AppState.currentUser = null;
            AppState.currentView = 'landing';
            render();
        };

        window.toggleProfileMenu = () => {
            const menu = document.getElementById('profileMenu');
            const notificationPanel = document.getElementById('notificationPanel');
            
            menu.classList.toggle('hidden');
            if (notificationPanel) notificationPanel.classList.add('hidden');
        };

        window.toggleNotifications = () => {
            const panel = document.getElementById('notificationPanel');
            const profileMenu = document.getElementById('profileMenu');
            
            panel.classList.toggle('hidden');
            if (profileMenu) profileMenu.classList.add('hidden');
        };

        window.clearAllNotifications = () => {
            AppState.notifications = [];
            render();
            showNotification('All notifications cleared', 'success');
        };

        window.dismissNotification = (notificationId) => {
            AppState.notifications = AppState.notifications.filter(n => n.id !== notificationId);
            render();
        };

        window.handleNotificationClick = (notificationId) => {
            const notification = AppState.notifications.find(n => n.id === notificationId);
            if (notification) {
                notification.read = true;
                render();
            }
        };

        window.refreshActivity = () => {
            const refreshButton = document.querySelector('button[onclick="window.refreshActivity()"] i');
            if (refreshButton) {
                refreshButton.classList.add('animate-spin');
                setTimeout(() => {
                    refreshButton.classList.remove('animate-spin');
                }, 1000);
            }
            showNotification('Activity refreshed successfully!', 'success');
            render();
        };

        window.viewExpenseDetail = (expenseId) => {
            const expense = AppState.expenses.find(e => e.id === expenseId);
            if (!expense) return;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="glass rounded-2xl p-8 max-w-4xl w-full max-h-96 overflow-y-auto custom-scrollbar">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                            <span class="text-2xl mr-3">${getCategoryIcon(expense.category)}</span>
                            Expense Details
                        </h3>
                        <button onclick="window.closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors p-2 rounded-lg hover:bg-gray-100">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                        <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-xl">
                            <p class="text-sm text-blue-600 font-medium mb-1">Description</p>
                            <p class="font-semibold text-gray-800">${expense.description}</p>
                        </div>
                        <div class="bg-gradient-to-r from-green-50 to-green-100 p-4 rounded-xl">
                            <p class="text-sm text-green-600 font-medium mb-1">Amount</p>
                            <p class="font-bold text-gray-800 text-lg">${formatCurrency(expense.amount, expense.currency)}</p>
                            ${expense.currency !== 'INR' ? `<p class="text-xs text-gray-500">${formatCurrency(convertCurrency(expense.amount, expense.currency))} INR</p>` : ''}
                        </div>
                        <div class="bg-gradient-to-r from-purple-50 to-purple-100 p-4 rounded-xl">
                            <p class="text-sm text-purple-600 font-medium mb-1">Category</p>
                            <p class="font-semibold text-gray-800 flex items-center">
                                <span class="mr-2">${getCategoryIcon(expense.category)}</span>
                                ${expense.category}
                            </p>
                        </div>
                        <div class="bg-gradient-to-r from-yellow-50 to-yellow-100 p-4 rounded-xl">
                            <p class="text-sm text-yellow-600 font-medium mb-1">Date</p>
                            <p class="font-semibold text-gray-800">${new Date(expense.date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        </div>
                        <div class="bg-gradient-to-r from-indigo-50 to-indigo-100 p-4 rounded-xl">
                            <p class="text-sm text-indigo-600 font-medium mb-1">Status</p>
                            <span class="inline-flex px-3 py-1 text-sm font-semibold rounded-full ${
                                expense.status === 'approved' ? 'bg-green-100 text-green-800' :
                                expense.status === 'rejected' ? 'bg-red-100 text-red-800' :
                                'bg-yellow-100 text-yellow-800'
                            }">
                                ${expense.status.toUpperCase()}
                            </span>
                        </div>
                        <div class="bg-gradient-to-r from-pink-50 to-pink-100 p-4 rounded-xl">
                            <p class="text-sm text-pink-600 font-medium mb-1">Submitted By</p>
                            <p class="font-semibold text-gray-800">${expense.submittedBy}</p>
                            <p class="text-xs text-gray-500">${formatTimeAgo(expense.submittedAt)}</p>
                        </div>
                    </div>
                    
                    ${expense.location ? `
                        <div class="bg-gradient-to-r from-cyan-50 to-cyan-100 p-4 rounded-xl mb-4">
                            <p class="text-sm text-cyan-600 font-medium mb-1 flex items-center">
                                <i data-lucide="map-pin" class="w-4 h-4 mr-1"></i>
                                Location
                            </p>
                            <p class="font-semibold text-gray-800">${expense.location}</p>
                        </div>
                    ` : ''}
                    
                    ${expense.vendor ? `
                        <div class="bg-gradient-to-r from-orange-50 to-orange-100 p-4 rounded-xl mb-4">
                            <p class="text-sm text-orange-600 font-medium mb-1 flex items-center">
                                <i data-lucide="store" class="w-4 h-4 mr-1"></i>
                                Vendor
                            </p>
                            <p class="font-semibold text-gray-800">${expense.vendor}</p>
                        </div>
                    ` : ''}
                    
                    ${expense.receipt ? `
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-xl mb-4">
                            <p class="text-sm text-blue-700 mb-2 flex items-center">
                                <i data-lucide="paperclip" class="w-4 h-4 mr-1"></i>
                                Receipt Attached
                            </p>
                            <p class="text-sm font-medium text-blue-800 bg-white px-3 py-2 rounded-lg inline-block">${expense.receipt}</p>
                        </div>
                    ` : ''}
                    
                    ${expense.notes ? `
                        <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-4 rounded-xl mb-4">
                            <p class="text-sm text-yellow-700 mb-2 flex items-center">
                                <i data-lucide="sticky-note" class="w-4 h-4 mr-1"></i>
                                Notes
                            </p>
                            <p class="text-sm text-yellow-800">${expense.notes}</p>
                        </div>
                    ` : ''}
                    
                    ${expense.tags && expense.tags.length > 0 ? `
                        <div class="bg-gradient-to-r from-gray-50 to-gray-100 p-4 rounded-xl mb-6">
                            <p class="text-sm text-gray-600 mb-2 flex items-center">
                                <i data-lucide="tags" class="w-4 h-4 mr-1"></i>
                                Tags
                            </p>
                            <div class="flex flex-wrap gap-2">
                                ${expense.tags.map(tag => `
                                    <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">#${tag}</span>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="flex space-x-3">
                        ${expense.status === 'pending' && AppState.currentUser.id === expense.submittedById ? `
                            <button onclick="window.editExpense('${expense.id}')" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-6 py-3 rounded-xl font-semibold transition-all transform hover:scale-105 flex items-center">
                                <i data-lucide="edit-2" class="w-4 h-4 mr-2"></i>
                                Edit Expense
                            </button>
                        ` : ''}
                        <button onclick="window.closeModal()" class="bg-gradient-to-r from-gray-300 to-gray-400 hover:from-gray-400 hover:to-gray-500 text-gray-700 px-6 py-3 rounded-xl font-semibold transition-all transform hover:scale-105">
                            Close
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            setTimeout(() => {
                if (window.lucide) lucide.createIcons();
            }, 0);
        };

        window.closeModal = () => {
            const modals = document.querySelectorAll('.fixed.inset-0');
            modals.forEach(modal => modal.remove());
        };

        window.editExpense = (expenseId) => {
            const expense = AppState.expenses.find(e => e.id === expenseId);
            if (!expense || expense.status !== 'pending') {
                showNotification('Cannot edit this expense', 'error');
                return;
            }
            showNotification(`Editing expense: ${expense.description}`, 'info');
        };

        // Enhanced notification system
        const showNotification = (message, type = 'info') => {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-xl shadow-2xl text-white font-medium transform transition-all duration-500 translate-x-full ${
                type === 'success' ? 'bg-gradient-to-r from-green-500 to-green-600' : 
                type === 'error' ? 'bg-gradient-to-r from-red-500 to-red-600' : 
                type === 'warning' ? 'bg-gradient-to-r from-yellow-500 to-yellow-600' :
                'bg-gradient-to-r from-blue-500 to-blue-600'
            }`;
            notification.innerHTML = `
                <div class="flex items-center space-x-3">
                    <i data-lucide="${
                        type === 'success' ? 'check-circle' :
                        type === 'error' ? 'x-circle' :
                        type === 'warning' ? 'alert-triangle' :
                        'info'
                    }" class="w-5 h-5"></i>
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white hover:text-gray-200 transition-colors">
                        <i data-lucide="x" class="w-4 h-4"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
                if (window.lucide) lucide.createIcons();
            }, 100);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 500);
                }
            }, 5000);
        };

        // Enhanced Login Page
        const LoginPage = () => `
            <div class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-blue-50 to-indigo-100 relative overflow-hidden">
                <!-- Animated Background -->
                <div class="absolute inset-0 overflow-hidden">
                    <div class="absolute -top-40 -right-40 w-80 h-80 bg-gradient-to-br from-blue-400 to-purple-600 rounded-full opacity-10 float"></div>
                    <div class="absolute -bottom-40 -left-40 w-96 h-96 bg-gradient-to-tr from-green-400 to-blue-500 rounded-full opacity-10 float" style="animation-delay: 2s;"></div>
                </div>
                
                <div class="max-w-md w-full relative z-10">
                    <div class="text-center mb-8 slide-up">
                        <div class="flex items-center justify-center mb-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center mr-3 shadow-lg">
                                <svg class="w-7 h-7 text-white" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2L2 7v10c0 5.55 3.84 9.74 9 11 5.16-1.26 9-5.45 9-11V7l-10-5z"/>
                                    <path d="M9 12l2 2 4-4" stroke="white" stroke-width="2" fill="none"/>
                                </svg>
                            </div>
                            <h1 class="text-5xl font-black">
                                <span class="gradient-text">Kharcha</span><span class="text-indigo-600">Kart</span>
                            </h1>
                        </div>
                        <p class="text-gray-600 text-lg">Welcome back! Sign in to continue</p>
                    </div>
                    
                    <div class="glass rounded-2xl shadow-2xl p-8 fade-in">
                        <form id="loginForm" class="space-y-6">
                            <div>
                                <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">Email Address</label>
                                <input type="email" id="email" required class="w-full px-4 py-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-white/50 backdrop-blur-sm" placeholder="Enter your email">
                            </div>
                            
                            <div>
                                <label for="password" class="block text-sm font-semibold text-gray-700 mb-2">Password</label>
                                <div class="relative">
                                    <input type="password" id="password" required class="w-full px-4 py-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all pr-12 bg-white/50 backdrop-blur-sm" placeholder="Enter your password">
                                    <button type="button" onclick="window.togglePassword('password')" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors">
                                        <i data-lucide="eye" class="w-5 h-5"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <label class="flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                    <span class="ml-2 text-sm text-gray-600">Remember me</span>
                                </label>
                                <button type="button" class="text-sm text-blue-600 hover:text-blue-800 font-medium">Forgot password?</button>
                            </div>
                            
                            <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white py-4 px-6 rounded-xl font-semibold transition-all transform hover:scale-105 shadow-lg hover:shadow-xl">
                                Sign In
                            </button>
                            
                            <div class="text-center">
                                <p class="text-sm text-gray-600">
                                    Don't have an account? 
                                    <button type="button" onclick="navigateTo('signup')" class="text-blue-600 hover:text-blue-800 font-semibold">Sign up</button>
                                </p>
                            </div>
                        </form>
                        
                        <div class="mt-8 pt-6 border-t border-gray-200">
                            <p class="text-xs text-gray-500 text-center mb-4 font-medium">Demo Credentials:</p>
                            <div class="grid grid-cols-1 gap-3 text-xs">
                                <div class="bg-gradient-to-r from-red-50 to-red-100 p-3 rounded-lg border border-red-200">
                                    <strong class="text-red-700">Admin:</strong> <span class="text-red-600">admin@kharcha.com / admin123</span>
                                </div>
                                <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-3 rounded-lg border border-blue-200">
                                    <strong class="text-blue-700">Manager:</strong> <span class="text-blue-600">manager@kharcha.com / manager123</span>
                                </div>
                                <div class="bg-gradient-to-r from-green-50 to-green-100 p-3 rounded-lg border border-green-200">
                                    <strong class="text-green-700">Employee:</strong> <span class="text-green-600">employee@kharcha.com / employee123</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center mt-6">
                        <button onclick="navigateTo('landing')" class="text-gray-600 hover:text-gray-800 text-sm font-medium flex items-center mx-auto">
                            <i data-lucide="arrow-left" class="w-4 h-4 mr-1"></i>
                            Back to Home
                        </button>
                    </div>
                </div>
            </div>
        `;

        // Enhanced Signup Page
        const SignupPage = () => `
            <div class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-green-50 to-blue-100 relative overflow-hidden">
                <!-- Animated Background -->
                <div class="absolute inset-0 overflow-hidden">
                    <div class="absolute -top-40 -right-40 w-80 h-80 bg-gradient-to-br from-green-400 to-blue-600 rounded-full opacity-10 float"></div>
                    <div class="absolute -bottom-40 -left-40 w-96 h-96 bg-gradient-to-tr from-blue-400 to-purple-500 rounded-full opacity-10 float" style="animation-delay: 2s;"></div>
                </div>
                
                <div class="max-w-md w-full relative z-10">
                    <div class="text-center mb-8 slide-up">
                        <div class="flex items-center justify-center mb-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center mr-3 shadow-lg">
                                <svg class="w-7 h-7 text-white" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2L2 7v10c0 5.55 3.84 9.74 9 11 5.16-1.26 9-5.45 9-11V7l-10-5z"/>
                                    <path d="M9 12l2 2 4-4" stroke="white" stroke-width="2" fill="none"/>
                                </svg>
                            </div>
                            <h1 class="text-5xl font-black">
                                <span class="gradient-text">Kharcha</span><span class="text-indigo-600">Kart</span>
                            </h1>
                        </div>
                        <p class="text-gray-600 text-lg">Create your account to get started</p>
                    </div>
                    
                    <div class="glass rounded-2xl shadow-2xl p-8 fade-in">
                        <form id="signupForm" class="space-y-6">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="firstName" class="block text-sm font-semibold text-gray-700 mb-2">First Name</label>
                                    <input type="text" id="firstName" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all bg-white/50 backdrop-blur-sm" placeholder="John">
                                </div>
                                <div>
                                    <label for="lastName" class="block text-sm font-semibold text-gray-700 mb-2">Last Name</label>
                                    <input type="text" id="lastName" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all bg-white/50 backdrop-blur-sm" placeholder="Doe">
                                </div>
                            </div>
                            
                            <div>
                                <label for="signupEmail" class="block text-sm font-semibold text-gray-700 mb-2">Email Address</label>
                                <input type="email" id="signupEmail" required class="w-full px-4 py-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all bg-white/50 backdrop-blur-sm" placeholder="john@company.com">
                            </div>
                            
                            <div>
                                <label for="department" class="block text-sm font-semibold text-gray-700 mb-2">Department</label>
                                <select id="department" required class="w-full px-4 py-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all bg-white/50 backdrop-blur-sm">
                                    <option value="">Select Department</option>
                                    <option value="Sales">Sales</option>
                                    <option value="Marketing">Marketing</option>
                                    <option value="Engineering">Engineering</option>
                                    <option value="Operations">Operations</option>
                                    <option value="Finance">Finance</option>
                                    <option value="HR">Human Resources</option>
                                    <option value="Administration">Administration</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="signupPassword" class="block text-sm font-semibold text-gray-700 mb-2">Password</label>
                                <div class="relative">
                                    <input type="password" id="signupPassword" required class="w-full px-4 py-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all pr-12 bg-white/50 backdrop-blur-sm" placeholder="Create a strong password">
                                    <button type="button" onclick="window.togglePassword('signupPassword')" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors">
                                        <i data-lucide="eye" class="w-5 h-5"></i>
                                    </button>
                                </div>
                                <div class="mt-2">
                                    <div class="flex items-center space-x-2 text-xs">
                                        <div id="passwordStrength" class="flex-1 bg-gray-200 rounded-full h-2">
                                            <div id="passwordStrengthBar" class="h-2 rounded-full transition-all duration-300 w-0"></div>
                                        </div>
                                        <span id="passwordStrengthText" class="text-gray-500 font-medium">Weak</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label for="confirmPassword" class="block text-sm font-semibold text-gray-700 mb-2">Confirm Password</label>
                                <input type="password" id="confirmPassword" required class="w-full px-4 py-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all bg-white/50 backdrop-blur-sm" placeholder="Confirm your password">
                            </div>
                            
                            <div class="flex items-center">
                                <input type="checkbox" id="terms" required class="rounded border-gray-300 text-green-600 focus:ring-green-500">
                                <label for="terms" class="ml-2 text-sm text-gray-600">
                                    I agree to the <button type="button" class="text-green-600 hover:text-green-800 font-semibold">Terms of Service</button> and <button type="button" class="text-green-600 hover:text-green-800 font-semibold">Privacy Policy</button>
                                </label>
                            </div>
                            
                            <button type="submit" class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white py-4 px-6 rounded-xl font-semibold transition-all transform hover:scale-105 shadow-lg hover:shadow-xl">
                                Create Account
                            </button>
                            
                            <div class="text-center">
                                <p class="text-sm text-gray-600">
                                    Already have an account? 
                                    <button type="button" onclick="navigateTo('login')" class="text-green-600 hover:text-green-800 font-semibold">Sign in</button>
                                </p>
                            </div>
                        </form>
                    </div>
                    
                    <div class="text-center mt-6">
                        <button onclick="navigateTo('landing')" class="text-gray-600 hover:text-gray-800 text-sm font-medium flex items-center mx-auto">
                            <i data-lucide="arrow-left" class="w-4 h-4 mr-1"></i>
                            Back to Home
                        </button>
                    </div>
                </div>
            </div>
        `;

        // Enhanced password toggle function
        window.togglePassword = (inputId) => {
            const input = document.getElementById(inputId);
            const button = input.nextElementSibling;
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.setAttribute('data-lucide', 'eye-off');
            } else {
                input.type = 'password';
                icon.setAttribute('data-lucide', 'eye');
            }
            
            if (window.lucide) {
                lucide.createIcons();
            }
        };

        // Enhanced form handlers
        const handleLogin = (event) => {
            event.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            const user = AppState.users[email];
            if (user && user.password === password) {
                AppState.currentUser = user;
                AppState.currentView = 'dashboard';
                showNotification(`Welcome back, ${user.name}!`, 'success');
                render();
            } else {
                showNotification('Invalid email or password', 'error');
            }
        };

        const handleSignup = (event) => {
            event.preventDefault();
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const email = document.getElementById('signupEmail').value;
            const department = document.getElementById('department').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            if (AppState.users[email]) {
                showNotification('Email already exists', 'error');
                return;
            }
            
            // Create new user
            const newUser = {
                id: generateId(),
                name: `${firstName} ${lastName}`,
                role: 'employee',
                email: email,
                password: password,
                department: department,
                joinDate: new Date().toISOString(),
                avatar: 'üë§',
                permissions: ['submit_expenses', 'view_own_expenses'],
                approvalLimit: 0
            };
            
            AppState.users[email] = newUser;
            AppState.currentUser = newUser;
            AppState.currentView = 'dashboard';
            showNotification(`Account created successfully! Welcome, ${newUser.name}!`, 'success');
            render();
        };

        // Close dropdowns when clicking outside
        document.addEventListener('click', (event) => {
            const profileMenu = document.getElementById('profileMenu');
            const notificationPanel = document.getElementById('notificationPanel');
            const profileButton = event.target.closest('button[onclick="window.toggleProfileMenu()"]');
            const notificationButton = event.target.closest('button[onclick="window.toggleNotifications()"]');
            
            if (profileMenu && !profileMenu.contains(event.target) && !profileButton) {
                profileMenu.classList.add('hidden');
            }
            
            if (notificationPanel && !notificationPanel.contains(event.target) && !notificationButton) {
                notificationPanel.classList.add('hidden');
            }
        });

        // Submit Expense Page
        const SubmitExpensePage = () => `
            <div class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
                ${Header()}
                <div class="max-w-4xl mx-auto px-4 py-8">
                    <div class="mb-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">Submit New Expense</h1>
                        <p class="text-gray-600">Fill out the form below to submit your expense for approval</p>
                    </div>
                    
                    <div class="glass rounded-2xl shadow-lg p-8">
                        <form id="expenseForm" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="expenseAmount" class="block text-sm font-semibold text-gray-700 mb-2">Amount *</label>
                                    <input type="number" id="expenseAmount" required step="0.01" min="0" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="0.00">
                                </div>
                                
                                <div>
                                    <label for="expenseCurrency" class="block text-sm font-semibold text-gray-700 mb-2">Currency *</label>
                                    <select id="expenseCurrency" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                        <option value="INR">INR (‚Çπ)</option>
                                        <option value="USD">USD ($)</option>
                                        <option value="EUR">EUR (‚Ç¨)</option>
                                        <option value="GBP">GBP (¬£)</option>
                                        <option value="CAD">CAD (C$)</option>
                                        <option value="AUD">AUD (A$)</option>
                                        <option value="SGD">SGD (S$)</option>
                                        <option value="JPY">JPY (¬•)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div>
                                <label for="expenseCategory" class="block text-sm font-semibold text-gray-700 mb-2">Category *</label>
                                <select id="expenseCategory" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                    <option value="">Select Category</option>
                                    ${AppState.categories.map(cat => `
                                        <option value="${cat.name}">${cat.icon} ${cat.name}</option>
                                    `).join('')}
                                </select>
                            </div>
                            
                            <div>
                                <label for="expenseDescription" class="block text-sm font-semibold text-gray-700 mb-2">Description *</label>
                                <input type="text" id="expenseDescription" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Brief description of the expense">
                            </div>
                            
                            <div>
                                <label for="expenseDate" class="block text-sm font-semibold text-gray-700 mb-2">Date *</label>
                                <input type="date" id="expenseDate" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" value="${new Date().toISOString().split('T')[0]}">
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="expenseLocation" class="block text-sm font-semibold text-gray-700 mb-2">Location</label>
                                    <input type="text" id="expenseLocation" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="City, Country">
                                </div>
                                
                                <div>
                                    <label for="expenseVendor" class="block text-sm font-semibold text-gray-700 mb-2">Vendor</label>
                                    <input type="text" id="expenseVendor" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Vendor/Company name">
                                </div>
                            </div>
                            
                            <div>
                                <label for="expenseNotes" class="block text-sm font-semibold text-gray-700 mb-2">Notes</label>
                                <textarea id="expenseNotes" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Additional notes or justification"></textarea>
                            </div>
                            
                            <div>
                                <label for="expenseTags" class="block text-sm font-semibold text-gray-700 mb-2">Tags</label>
                                <input type="text" id="expenseTags" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Separate tags with commas (e.g., urgent, client-meeting)">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Receipt</label>
                                <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-blue-400 transition-colors">
                                    <i data-lucide="upload" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
                                    <p class="text-gray-600 mb-2">Upload receipt (optional)</p>
                                    <input type="file" id="expenseReceipt" accept="image/*,.pdf" class="hidden">
                                    <button type="button" onclick="document.getElementById('expenseReceipt').click()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                                        Choose File
                                    </button>
                                    <div id="receiptPreview" class="mt-4 hidden">
                                        <p class="text-sm text-green-600 font-medium">Receipt uploaded successfully!</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex space-x-4 pt-6">
                                <button type="submit" class="flex-1 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white py-4 px-6 rounded-xl font-semibold transition-all transform hover:scale-105 shadow-lg hover:shadow-xl">
                                    Submit Expense
                                </button>
                                <button type="button" onclick="navigateTo('dashboard')" class="px-8 py-4 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-xl font-semibold transition-all">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        `;

        // Expenses List Page
        const ExpensesPage = () => {
            const user = AppState.currentUser;
            const userExpenses = user.role === 'employee' 
                ? AppState.expenses.filter(e => e.submittedById === user.id)
                : AppState.expenses;

            return `
                <div class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
                    ${Header()}
                    <div class="max-w-7xl mx-auto px-4 py-8">
                        <div class="flex items-center justify-between mb-8">
                            <div>
                                <h1 class="text-3xl font-bold text-gray-800 mb-2">All Expenses</h1>
                                <p class="text-gray-600">Manage and track your expense submissions</p>
                            </div>
                            <button onclick="navigateTo('submit')" class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-6 py-3 rounded-xl font-semibold transition-all transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center">
                                <i data-lucide="plus" class="w-5 h-5 mr-2"></i>
                                New Expense
                            </button>
                        </div>
                        
                        <!-- Filters -->
                        <div class="glass rounded-xl p-6 mb-8">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                                    <select id="statusFilter" onchange="window.applyFilters()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="all">All Status</option>
                                        <option value="pending">Pending</option>
                                        <option value="approved">Approved</option>
                                        <option value="rejected">Rejected</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                                    <select id="categoryFilter" onchange="window.applyFilters()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="all">All Categories</option>
                                        ${AppState.categories.map(cat => `
                                            <option value="${cat.name}">${cat.icon} ${cat.name}</option>
                                        `).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Date Range</label>
                                    <select id="dateFilter" onchange="window.applyFilters()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="all">All Time</option>
                                        <option value="today">Today</option>
                                        <option value="week">This Week</option>
                                        <option value="month">This Month</option>
                                        <option value="quarter">This Quarter</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Search</label>
                                    <input type="text" id="searchFilter" onkeyup="window.applyFilters()" placeholder="Search expenses..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Expenses Table -->
                        <div class="glass rounded-xl shadow-lg overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gradient-to-r from-gray-50 to-blue-50">
                                        <tr>
                                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="expensesTableBody" class="bg-white divide-y divide-gray-200">
                                        ${userExpenses.map(expense => `
                                            <tr class="hover:bg-gray-50 transition-colors">
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="flex items-center">
                                                        <span class="text-2xl mr-3">${getCategoryIcon(expense.category)}</span>
                                                        <div>
                                                            <div class="text-sm font-medium text-gray-900">${expense.description}</div>
                                                            <div class="text-sm text-gray-500">${expense.submittedBy}</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm font-medium text-gray-900">${formatCurrency(expense.amount, expense.currency)}</div>
                                                    ${expense.currency !== 'INR' ? `<div class="text-sm text-gray-500">${formatCurrency(convertCurrency(expense.amount, expense.currency))}</div>` : ''}
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                        ${expense.category}
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                    ${new Date(expense.date).toLocaleDateString()}
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                                                        expense.status === 'approved' ? 'bg-green-100 text-green-800' :
                                                        expense.status === 'rejected' ? 'bg-red-100 text-red-800' :
                                                        'bg-yellow-100 text-yellow-800'
                                                    }">
                                                        ${expense.status.toUpperCase()}
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                    <div class="flex space-x-2">
                                                        <button onclick="window.viewExpenseDetail('${expense.id}')" class="text-blue-600 hover:text-blue-900 transition-colors">
                                                            <i data-lucide="eye" class="w-4 h-4"></i>
                                                        </button>
                                                        ${expense.status === 'pending' && user.id === expense.submittedById ? `
                                                            <button onclick="window.editExpense('${expense.id}')" class="text-green-600 hover:text-green-900 transition-colors">
                                                                <i data-lucide="edit-2" class="w-4 h-4"></i>
                                                            </button>
                                                            <button onclick="window.deleteExpense('${expense.id}')" class="text-red-600 hover:text-red-900 transition-colors">
                                                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                                                            </button>
                                                        ` : ''}
                                                    </div>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        // Approvals Page
        const ApprovalsPage = () => {
            const user = AppState.currentUser;
            const pendingApprovals = AppState.expenses.filter(e => 
                e.status === 'pending' && 
                (user.role === 'admin' || user.role === 'finance' || 
                 (user.role === 'manager' && e.currentApprover === 'manager'))
            );

            return `
                <div class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
                    ${Header()}
                    <div class="max-w-7xl mx-auto px-4 py-8">
                        <div class="mb-8">
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">Pending Approvals</h1>
                            <p class="text-gray-600">Review and approve expense submissions</p>
                        </div>
                        
                        ${pendingApprovals.length > 0 ? `
                            <div class="space-y-6">
                                ${pendingApprovals.map(expense => `
                                    <div class="glass rounded-xl p-6 hover:shadow-lg transition-shadow">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-4">
                                                <div class="w-16 h-16 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl flex items-center justify-center">
                                                    <span class="text-2xl">${getCategoryIcon(expense.category)}</span>
                                                </div>
                                                <div>
                                                    <h3 class="text-lg font-semibold text-gray-800">${expense.description}</h3>
                                                    <p class="text-sm text-gray-600">Submitted by ${expense.submittedBy} ‚Ä¢ ${formatTimeAgo(expense.submittedAt)}</p>
                                                    <div class="flex items-center space-x-4 mt-2">
                                                        <span class="text-sm text-gray-500">Category: ${expense.category}</span>
                                                        <span class="text-sm text-gray-500">Date: ${new Date(expense.date).toLocaleDateString()}</span>
                                                        ${expense.location ? `<span class="text-sm text-gray-500">Location: ${expense.location}</span>` : ''}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <p class="text-2xl font-bold text-gray-800">${formatCurrency(expense.amount, expense.currency)}</p>
                                                ${expense.currency !== 'INR' ? `<p class="text-sm text-gray-500">${formatCurrency(convertCurrency(expense.amount, expense.currency))}</p>` : ''}
                                            </div>
                                        </div>
                                        
                                        ${expense.notes ? `
                                            <div class="mt-4 p-3 bg-yellow-50 rounded-lg">
                                                <p class="text-sm text-yellow-800"><strong>Notes:</strong> ${expense.notes}</p>
                                            </div>
                                        ` : ''}
                                        
                                        <div class="flex items-center justify-between mt-6">
                                            <button onclick="window.viewExpenseDetail('${expense.id}')" class="text-blue-600 hover:text-blue-800 font-medium flex items-center">
                                                <i data-lucide="eye" class="w-4 h-4 mr-1"></i>
                                                View Details
                                            </button>
                                            <div class="flex space-x-3">
                                                <button onclick="window.rejectExpense('${expense.id}')" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg font-medium transition-colors flex items-center">
                                                    <i data-lucide="x" class="w-4 h-4 mr-1"></i>
                                                    Reject
                                                </button>
                                                <button onclick="window.approveExpense('${expense.id}')" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg font-medium transition-colors flex items-center">
                                                    <i data-lucide="check" class="w-4 h-4 mr-1"></i>
                                                    Approve
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="text-center py-16">
                                <div class="w-24 h-24 bg-gradient-to-br from-green-100 to-green-200 rounded-full flex items-center justify-center mx-auto mb-6">
                                    <i data-lucide="check-circle" class="w-12 h-12 text-green-600"></i>
                                </div>
                                <h3 class="text-xl font-semibold text-gray-600 mb-3">All Caught Up!</h3>
                                <p class="text-sm text-gray-500">No pending approvals at the moment.</p>
                            </div>
                        `}
                    </div>
                </div>
            `;
        };

        // Enhanced render function
        const render = () => {
            const app = document.getElementById('app');
            
            if (!AppState.currentUser) {
                switch (AppState.currentView) {
                    case 'login':
                        app.innerHTML = LoginPage();
                        setTimeout(() => {
                            const form = document.getElementById('loginForm');
                            if (form) {
                                form.addEventListener('submit', handleLogin);
                            }
                        }, 0);
                        break;
                    case 'signup':
                        app.innerHTML = SignupPage();
                        setTimeout(() => {
                            const form = document.getElementById('signupForm');
                            if (form) {
                                form.addEventListener('submit', handleSignup);
                            }
                        }, 0);
                        break;
                    default:
                        app.innerHTML = LandingPage();
                }
            } else {
                switch (AppState.currentView) {
                    case 'dashboard':
                        app.innerHTML = Dashboard();
                        break;
                    case 'submit':
                        app.innerHTML = SubmitExpensePage();
                        setTimeout(() => {
                            const form = document.getElementById('expenseForm');
                            if (form) {
                                form.addEventListener('submit', handleExpenseSubmit);
                            }
                            const receiptInput = document.getElementById('expenseReceipt');
                            if (receiptInput) {
                                receiptInput.addEventListener('change', handleReceiptUpload);
                            }
                        }, 0);
                        break;
                    case 'expenses':
                        app.innerHTML = ExpensesPage();
                        break;
                    case 'approvals':
                        app.innerHTML = ApprovalsPage();
                        break;
                    default:
                        app.innerHTML = Dashboard();
                }
            }
            
            // Initialize Lucide icons
            setTimeout(() => {
                if (window.lucide) {
                    lucide.createIcons();
                }
            }, 0);
        };

        // Expense Form Handlers
        const handleExpenseSubmit = (event) => {
            event.preventDefault();
            
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const currency = document.getElementById('expenseCurrency').value;
            const category = document.getElementById('expenseCategory').value;
            const description = document.getElementById('expenseDescription').value;
            const date = document.getElementById('expenseDate').value;
            const location = document.getElementById('expenseLocation').value;
            const vendor = document.getElementById('expenseVendor').value;
            const notes = document.getElementById('expenseNotes').value;
            const tags = document.getElementById('expenseTags').value;
            
            if (!amount || !currency || !category || !description || !date) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            const newExpense = {
                id: generateId(),
                amount: amount,
                currency: currency,
                category: category,
                description: description,
                date: date,
                status: 'pending',
                submittedBy: AppState.currentUser.name,
                submittedById: AppState.currentUser.id,
                approvalFlow: AppState.currentUser.role === 'employee' ? ['manager', 'admin'] : ['admin'],
                currentApprover: AppState.currentUser.role === 'employee' ? 'manager' : 'admin',
                receipt: document.getElementById('expenseReceipt').files[0]?.name || null,
                submittedAt: new Date().toISOString(),
                location: location || null,
                vendor: vendor || null,
                notes: notes || null,
                tags: tags ? tags.split(',').map(tag => tag.trim()) : []
            };
            
            AppState.expenses.unshift(newExpense);
            
            // Add notification for approvers
            const notification = {
                id: generateId(),
                title: 'üìÑ New Expense Submitted',
                message: `${AppState.currentUser.name} submitted a ${category.toLowerCase()} expense for ${formatCurrency(amount, currency)}`,
                type: 'info',
                timestamp: new Date().toISOString(),
                read: false,
                actionUrl: '/approvals'
            };
            AppState.notifications.unshift(notification);
            
            showNotification('Expense submitted successfully!', 'success');
            navigateTo('expenses');
        };

        const handleReceiptUpload = (event) => {
            const file = event.target.files[0];
            const preview = document.getElementById('receiptPreview');
            
            if (file) {
                preview.classList.remove('hidden');
                showNotification('Receipt uploaded successfully!', 'success');
            } else {
                preview.classList.add('hidden');
            }
        };

        // Approval Functions
        window.approveExpense = (expenseId) => {
            const expense = AppState.expenses.find(e => e.id === expenseId);
            if (!expense) return;
            
            expense.status = 'approved';
            expense.approvedAt = new Date().toISOString();
            expense.approvedBy = AppState.currentUser.name;
            expense.currentApprover = null;
            
            // Add notification to submitter
            const notification = {
                id: generateId(),
                title: '‚úÖ Expense Approved',
                message: `Your ${expense.category.toLowerCase()} expense of ${formatCurrency(expense.amount, expense.currency)} has been approved by ${AppState.currentUser.name}`,
                type: 'success',
                timestamp: new Date().toISOString(),
                read: false,
                actionUrl: `/expenses/${expenseId}`
            };
            AppState.notifications.unshift(notification);
            
            showNotification(`Expense approved: ${expense.description}`, 'success');
            render();
        };

        window.rejectExpense = (expenseId) => {
            const reason = prompt('Please provide a reason for rejection:');
            if (!reason) return;
            
            const expense = AppState.expenses.find(e => e.id === expenseId);
            if (!expense) return;
            
            expense.status = 'rejected';
            expense.rejectedAt = new Date().toISOString();
            expense.rejectedBy = AppState.currentUser.name;
            expense.rejectionReason = reason;
            expense.currentApprover = null;
            
            // Add notification to submitter
            const notification = {
                id: generateId(),
                title: '‚ùå Expense Rejected',
                message: `Your ${expense.category.toLowerCase()} expense was rejected: ${reason}`,
                type: 'error',
                timestamp: new Date().toISOString(),
                read: false,
                actionUrl: `/expenses/${expenseId}`
            };
            AppState.notifications.unshift(notification);
            
            showNotification(`Expense rejected: ${expense.description}`, 'error');
            render();
        };

        window.deleteExpense = (expenseId) => {
            if (!confirm('Are you sure you want to delete this expense?')) return;
            
            const expenseIndex = AppState.expenses.findIndex(e => e.id === expenseId);
            if (expenseIndex === -1) return;
            
            const expense = AppState.expenses[expenseIndex];
            AppState.expenses.splice(expenseIndex, 1);
            
            showNotification(`Expense deleted: ${expense.description}`, 'success');
            render();
        };

        // Filter Functions
        window.applyFilters = () => {
            const statusFilter = document.getElementById('statusFilter')?.value || 'all';
            const categoryFilter = document.getElementById('categoryFilter')?.value || 'all';
            const dateFilter = document.getElementById('dateFilter')?.value || 'all';
            const searchFilter = document.getElementById('searchFilter')?.value.toLowerCase() || '';
            
            const user = AppState.currentUser;
            let expenses = user.role === 'employee' 
                ? AppState.expenses.filter(e => e.submittedById === user.id)
                : AppState.expenses;
            
            // Apply filters
            if (statusFilter !== 'all') {
                expenses = expenses.filter(e => e.status === statusFilter);
            }
            
            if (categoryFilter !== 'all') {
                expenses = expenses.filter(e => e.category === categoryFilter);
            }
            
            if (dateFilter !== 'all') {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                
                expenses = expenses.filter(e => {
                    const expenseDate = new Date(e.date);
                    
                    switch (dateFilter) {
                        case 'today':
                            return expenseDate >= today;
                        case 'week':
                            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                            return expenseDate >= weekAgo;
                        case 'month':
                            return expenseDate.getMonth() === now.getMonth() && 
                                   expenseDate.getFullYear() === now.getFullYear();
                        case 'quarter':
                            const quarter = Math.floor(now.getMonth() / 3);
                            const expenseQuarter = Math.floor(expenseDate.getMonth() / 3);
                            return expenseQuarter === quarter && 
                                   expenseDate.getFullYear() === now.getFullYear();
                        default:
                            return true;
                    }
                });
            }
            
            if (searchFilter) {
                expenses = expenses.filter(e => 
                    e.description.toLowerCase().includes(searchFilter) ||
                    e.category.toLowerCase().includes(searchFilter) ||
                    e.submittedBy.toLowerCase().includes(searchFilter) ||
                    (e.vendor && e.vendor.toLowerCase().includes(searchFilter)) ||
                    (e.location && e.location.toLowerCase().includes(searchFilter))
                );
            }
            
            // Update table
            const tableBody = document.getElementById('expensesTableBody');
            if (tableBody) {
                tableBody.innerHTML = expenses.map(expense => `
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">${getCategoryIcon(expense.category)}</span>
                                <div>
                                    <div class="text-sm font-medium text-gray-900">${expense.description}</div>
                                    <div class="text-sm text-gray-500">${expense.submittedBy}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">${formatCurrency(expense.amount, expense.currency)}</div>
                            ${expense.currency !== 'INR' ? `<div class="text-sm text-gray-500">${formatCurrency(convertCurrency(expense.amount, expense.currency))}</div>` : ''}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                ${expense.category}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${new Date(expense.date).toLocaleDateString()}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                                expense.status === 'approved' ? 'bg-green-100 text-green-800' :
                                expense.status === 'rejected' ? 'bg-red-100 text-red-800' :
                                'bg-yellow-100 text-yellow-800'
                            }">
                                ${expense.status.toUpperCase()}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-2">
                                <button onclick="window.viewExpenseDetail('${expense.id}')" class="text-blue-600 hover:text-blue-900 transition-colors">
                                    <i data-lucide="eye" class="w-4 h-4"></i>
                                </button>
                                ${expense.status === 'pending' && user.id === expense.submittedById ? `
                                    <button onclick="window.editExpense('${expense.id}')" class="text-green-600 hover:text-green-900 transition-colors">
                                        <i data-lucide="edit-2" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="window.deleteExpense('${expense.id}')" class="text-red-600 hover:text-red-900 transition-colors">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `).join('');
                
                // Re-initialize icons
                if (window.lucide) {
                    lucide.createIcons();
                }
            }
        };

        // Initialize the application
        render();
        
        // Add welcome message
        setTimeout(() => {
            if (!AppState.currentUser) {
                showNotification('üöÄ Welcome to KharchaKart! Try the demo accounts to explore all features.', 'info');
            }
        }, 2000);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98927e9ab25c85b4',t:'MTc1OTU1ODAwMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
<!-- Modals for Edit Profile and Profile Settings -->
<div id="editProfileModal" class="fixed inset-0 hidden items-center justify-center z-50 bg-black bg-opacity-40">
  <div class="bg-white rounded-xl shadow-lg p-6 w-full max-w-md">
    <h2 class="text-xl font-bold mb-4">Edit Profile</h2>
    <label class="block mb-2 text-sm">Name</label>
    <input id="editName" class="border rounded w-full mb-3 p-2" />
    <label class="block mb-2 text-sm">Email</label>
    <input id="editEmail" class="border rounded w-full mb-3 p-2" />
    <label class="block mb-2 text-sm">Department</label>
    <input id="editDept" class="border rounded w-full mb-4 p-2" />
    <div class="flex justify-end space-x-2">
      <button onclick="closeModal('editProfileModal')" class="px-4 py-2 bg-gray-300 rounded">Cancel</button>
      <button onclick="saveProfile()" class="px-4 py-2 bg-blue-600 text-white rounded">Save</button>
    </div>
  </div>
</div>

<div id="settingsModal" class="fixed inset-0 hidden items-center justify-center z-50 bg-black bg-opacity-40">
  <div class="bg-white rounded-xl shadow-lg p-6 w-full max-w-md">
    <h2 class="text-xl font-bold mb-4">Profile Settings</h2>
    <label class="block mb-2 text-sm">Theme</label>
    <select id="settingTheme" class="border rounded w-full mb-3 p-2">
      <option value="light">Light</option>
      <option value="dark">Dark</option>
    </select>
    <label class="block mb-2 text-sm">Currency</label>
    <input id="settingCurrency" class="border rounded w-full mb-3 p-2" value="INR" />
    <div class="flex items-center mb-4">
      <input id="settingNotifications" type="checkbox" class="mr-2" checked />
      <label for="settingNotifications" class="text-sm">Enable Notifications</label>
    </div>
    <div class="flex justify-end space-x-2">
      <button onclick="closeModal('settingsModal')" class="px-4 py-2 bg-gray-300 rounded">Cancel</button>
      <button onclick="saveSettings()" class="px-4 py-2 bg-blue-600 text-white rounded">Save</button>
    </div>
  </div>
</div>

<script>
function openModal(id) {
  const el = document.getElementById(id);
  if (el) { el.classList.remove('hidden'); el.classList.add('flex'); }
}
function closeModal(id) {
  const el = document.getElementById(id);
  if (el) { el.classList.add('hidden'); el.classList.remove('flex'); }
}

// Save profile edits
function saveProfile() {
  const name = document.getElementById('editName').value;
  const email = document.getElementById('editEmail').value;
  const dept = document.getElementById('editDept').value;
  localStorage.setItem('userName', name);
  localStorage.setItem('userEmail', email);
  localStorage.setItem('userDept', dept);
  alert('Save Successful');
  closeModal('editProfileModal');
}

// Save settings edits
function saveSettings() {
  const theme = document.getElementById('settingTheme').value;
  const currency = document.getElementById('settingCurrency').value;
  const notifications = document.getElementById('settingNotifications').checked;
  localStorage.setItem('theme', theme);
  localStorage.setItem('currency', currency);
  localStorage.setItem('notifications', notifications);
  alert('Save Successful');
  closeModal('settingsModal');
}

// Hook profile buttons
document.addEventListener('DOMContentLoaded', () => {
  const editBtn = Array.from(document.querySelectorAll('button')).find(b => b.innerText.toLowerCase().includes('edit'));
  const settingsBtn = Array.from(document.querySelectorAll('button')).find(b => b.innerText.toLowerCase().includes('profile settings'));
  if (editBtn) editBtn.addEventListener('click', () => openModal('editProfileModal'));
  if (settingsBtn) settingsBtn.addEventListener('click', () => openModal('settingsModal'));
});
</script>

</body>
</html>
